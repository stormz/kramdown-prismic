#!/usr/bin/env ruby

require 'kramdown-prismic'
require 'json'
require 'optparse'

begin
  options = {}
  OptionParser.new do |opts|
    opts.banner = "Usage: prismic2markdown [options]"

    opts.on("-fFORMAT", "--format=FORMAT", "Prismic format to use") do |format|
      options[:format] = format&.strip&.downcase&.to_sym
    end
  end.parse!

  source = JSON.parse(ARGV[0], symbolize_names: true)

  format = case options.fetch(:format, :v1)
    when :v1
      :prismic
    when :v2
      :prismic_v2
    else
      print "Unknown Prismic fomat variant"
  end

  document = Kramdown::Document.new(source, input: format)

  print document.to_html
end